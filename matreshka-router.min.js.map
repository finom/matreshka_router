{"version":3,"sources":["matreshka-router.min.js"],"names":["root","factory","define","amd","module","exports","require","Matreshka","this","MK","Router","type","Error","linkProps","onDebounce","on","set","win","window","extend","prototype","parts","url","hashBang","init","initialized","_this","location","document","v","fixed","replace","split","i","length","push","join","evt","value","prevValue","previousValue","equals","trigger","addEventListener","hash","hashEvent","state","validPush","pathname","popEvent","history","pushState","subscribe","obj","route","keys","changeEvents","filter","key","routeSilent","values","initRouter"],"mappings":"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","file":"matreshka-router.min.js","sourcesContent":["(function(root, factory) {\n\t/* istanbul ignore next */\n\tif (typeof define === 'function' && define.amd) {\n\t\tdefine(['matreshka'], factory);\n\t} else if (typeof module === 'object' && module.exports) {\n\t\tmodule.exports = factory(require('matreshka'));\n\t} else {\n\t\tfactory(root.Matreshka);\n\t}\n}(this, function(MK) {\n\t\"use strict\";\n\n\t/* istanbul ignore if */\n\tif (!MK) {\n\t\tthrow Error('Matreshka is missing');\n\t}\n\n\tvar linkProps = MK.linkProps,\n\t\tonDebounce = MK.onDebounce,\n\t\ton = MK.on,\n\t\tset = MK.set,\n\t\twin = typeof window != 'undefined' ? window : null;\n\n\tfunction Router(type) {\n\t\t// singletone pattern for history and hash router\n\t\tif (type in Router) {\n\t\t\treturn Router[type];\n\t\t}\n\n\t\tthis.type = type;\n\t}\n\n\tMK.extend(Router.prototype, {\n\t\tparts: [],\n\t\turl: '/',\n\t\thashBang: '!#/',\n\t\tinit: function() {\n\t\t\tif (this.initialized) return;\n\n\t\t\tvar _this = this,\n\t\t\t\ttype = _this.type,\n\t\t\t\tlocation = document.location;\n\n\n\t\t\tlinkProps(_this, 'parts', 'url', function(v) {\n\t\t\t\tvar fixed = v.replace(/\\/\\//g, '/')\n\t\t\t\t\t.replace(/^\\/|\\/$/g, '');\n\n\t\t\t\treturn fixed ? fixed.split('/') : [];\n\t\t\t});\n\n\t\t\tlinkProps(_this, 'url', 'parts', function(v) {\n\t\t\t\tvar parts = [],\n\t\t\t\t\ti;\n\t\t\t\tfor (i = 0; i < v.length; i++) {\n\t\t\t\t\tif (v[i]) {\n\t\t\t\t\t\tparts.push(v[i]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn parts.length ? ('/' + parts.join('/') + '/') : '/';\n\t\t\t});\n\n\t\t\tlinkProps(_this, 'hashBang', 'url', function(v) {\n\t\t\t\treturn v && v != '/' ? '#!' + v : '';\n\t\t\t});\n\n\t\t\tlinkProps(_this, 'url', 'hashBang', function(v) {\n\t\t\t\treturn v ? v.replace(/^#!/, '') : '';\n\t\t\t});\n\n\t\t\ton(_this, 'change:parts', function(evt) {\n\t\t\t\tvar value = evt.value,\n\t\t\t\t\tprevValue = evt.previousValue,\n\t\t\t\t\tequals = value.length == prevValue.length,\n\t\t\t\t\ti;\n\n\t\t\t\tif (equals) {\n\t\t\t\t\tfor (i = 0; i < value.length; i++) {\n\t\t\t\t\t\tif (value[i] != prevValue[i]) {\n\t\t\t\t\t\t\tequals = false;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!equals) {\n\t\t\t\t\tMK.trigger(_this, 'urlchange');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (win) {\n\t\t\t\tif (type == 'hash') {\n\t\t\t\t\twin.addEventListener('hashchange', function() {\n\t\t\t\t\t\tset(_this, 'hashBang', location.hash, {\n\t\t\t\t\t\t\thashEvent: true\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\tonDebounce(_this, 'change:hashBang', function(evt) {\n\t\t\t\t\t\tif (!evt || !evt.hashEvent) {\n\t\t\t\t\t\t\tlocation.hash = _this.hashBang;\n\t\t\t\t\t\t}\n\t\t\t\t\t}, true);\n\t\t\t\t} else if (type == 'history') {\n\t\t\t\t\twin.addEventListener('popstate', function(evt) {\n\t\t\t\t\t\tif (evt.state && evt.state.validPush) {\n\t\t\t\t\t\t\tset(_this, 'url', location.pathname, {\n\t\t\t\t\t\t\t\tpopEvent: true\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tonDebounce(_this, 'change:url', function(evt) {\n\t\t\t\t\t\tif (!evt || !evt.popEvent) {\n\t\t\t\t\t\t\thistory.pushState({\n\t\t\t\t\t\t\t\tvalidPush: true\n\t\t\t\t\t\t\t}, '', _this.url + location.hash);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t_this.initialized = true;\n\n\t\t\treturn _this;\n\n\t\t},\n\t\tsubscribe: function(obj, route) {\n\t\t\tvar _this = this,\n\t\t\t\tkeys = route.replace(/\\/\\//g, '/').replace(/^\\/|\\/$/g, '').split('/'),\n\t\t\t\tchangeEvents = [],\n\t\t\t\tfilteredKeys = keys.filter(function(key) {\n\t\t\t\t\treturn key != '*';\n\t\t\t\t}),\n\t\t\t\tparts = [],\n\t\t\t\ti;\n\n\t\t\t_this.init();\n\n\t\t\tfor(i = 0; i < keys.length; i++) {\n\t\t\t\tif(keys[i] != '*') {\n\t\t\t\t\tchangeEvents.push('change:' + keys[i]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ton(obj, changeEvents, function(evt) {\n\t\t\t\tif (evt && evt.routeSilent) return;\n\n\t\t\t\tvar values = [],\n\t\t\t\t\ti,\n\t\t\t\t\tvalue;\n\n\t\t\t\tfor (i = 0; i < keys.length; i++) {\n\t\t\t\t\tvalue = keys[i] != '*' ? obj[keys[i]] : _this.parts[i];\n\n\t\t\t\t\tif (value) {\n\t\t\t\t\t\tvalues.push(value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t_this.parts = values;\n\t\t\t});\n\n\t\t\ton(_this, 'urlchange', function() {\n\t\t\t\tvar i;\n\t\t\t\tfor (i = 0; i < keys.length; i++) {\n\t\t\t\t\tif (keys[i] != '*') {\n\t\t\t\t\t\tset(obj, keys[i], _this.parts[i] || null, {\n\t\t\t\t\t\t\trouteSilent: true\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfor (i = 0; i < keys.length; i++) {\n\t\t\t\tparts.push(obj[keys[i]] == '*' ? _this.parts[i] : obj[keys[i]] || _this.parts[i]);\n\t\t\t}\n\n\t\t\t_this.parts = parts;\n\n\t\t\treturn _this;\n\t\t}\n\t});\n\n\tMK.Router = Router;\n\tMK.Router.history = new Router('history');\n\tMK.Router.hash = new Router('hash');\n\n\tMK.initRouter = function(obj, route, type) {\n\t\tMK.Router[type || 'hash'].subscribe(obj, route);\n\t\treturn obj;\n\t};\n\n\tMK.prototype.initRouter = function(route, type) {\n\t\tMK.Router[type || 'hash'].subscribe(this, route);\n\t\treturn this;\n\t};\n\n\treturn Router;\n}));\n"],"sourceRoot":"/source/"}
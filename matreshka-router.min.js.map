{"version":3,"sources":["matreshka-router.min.js"],"names":["root","factory","define","amd","module","exports","require","Matreshka","this","MK","Router","type","Error","extend","prototype","parts","url","hashBang","init","initialized","linkProps","v","fixed","replace","split","i","length","push","join","on","evt","value","prevValue","previousValue","equals","trigger","window","addEventListener","set","location","hash","hashEvent","bind","onDebounce","state","azaza","pathname","popEvent","history","pushState","subscribe","obj","route","keys","filteredKeys","filter","key","map","routeSilent","values","initRouter"],"mappings":"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","file":"matreshka-router.min.js","sourcesContent":["(function(root, factory) {\n\tif (typeof define === 'function' && define.amd) {\n\t\tdefine(['matreshka'], factory);\n\t} else if (typeof module === 'object' && module.exports) {\n\t\tmodule.exports = factory(require('matreshka'));\n\t} else {\n\t\tfactory(root.Matreshka);\n\t}\n}(this, function(MK) {\n\t\"use strict\";\n\n\tif(!MK) {\n\t\tthrow Error('Matreshka is missing');\n\t}\n\n\tfunction Router(type) {\n\t\t// singletone pattern for history and hash router\n\t\tif(type in Router) {\n\t\t\treturn Router[type];\n\t\t}\n\n\t\tthis.type = type;\n\t}\n\n\tMK.extend(Router.prototype, {\n\t\tparts: [],\n\t\turl: '/',\n\t\thashBang: '!#/',\n\t\tinit: function() {\n\t\t\tif(!this.initialized) {\n\t\t\t\tMK.linkProps(this, 'parts', 'url', function(v) {\n\t\t\t\t\tvar fixed = v.replace(/\\/\\//g, '/')\n\t\t\t\t\t\t.replace(/^\\/|\\/$/g, '');\n\n\t\t\t\t\treturn fixed ? fixed.split('/') : [];\n\t\t\t\t});\n\n\t\t\t\tMK.linkProps(this, 'url', 'parts', function(v) {\n\t\t\t\t\tvar parts = [];\n\t\t\t\t\tfor(var i = 0; i < v.length; i++) {\n\t\t\t\t\t\tif(v[i]) {\n\t\t\t\t\t\t\tparts.push(v[i]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn parts.length ? ('/' + parts.join('/') + '/') : '/';\n\t\t\t\t});\n\n\t\t\t\tMK.linkProps(this, 'hashBang', 'url', function(v) {\n\t\t\t\t\treturn v && v != '/' ? '#!' + v : '';\n\t\t\t\t});\n\n\t\t\t\tMK.linkProps(this, 'url', 'hashBang', function(v) {\n\t\t\t\t\treturn v ? v.replace(/^#!/, '') : '';\n\t\t\t\t});\n\n\t\t\t\tMK.on(this, 'change:parts', function(evt) {\n\t\t\t\t\tvar value = evt.value,\n\t\t\t\t\t\tprevValue = evt.previousValue,\n\t\t\t\t\t\tequals = value.length == prevValue.length;\n\n\t\t\t\t\tif(equals) {\n\t\t\t\t\t\tfor(var i = 0; i < value.length; i++) {\n\t\t\t\t\t\t\tif(value[i] != prevValue[i]) {\n\t\t\t\t\t\t\t\tequals = false;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif(!equals) {\n\t\t\t\t\t\tMK.trigger(this, 'urlchange');\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif(typeof window != 'undefined') {\n\t\t\t\t\tif(this.type == 'hash') {\n\t\t\t\t\t\twindow.addEventListener('hashchange', function() {\n\t\t\t\t\t\t\tMK.set(this, 'hashBang', location.hash, {\n\t\t\t\t\t\t\t\thashEvent: true\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}.bind(this));\n\n\t\t\t\t\t\tMK.onDebounce(this, 'change:hashBang', function(evt) {\n\t\t\t\t\t\t\tif(!evt || !evt.hashEvent) {\n\t\t\t\t\t\t\t\tlocation.hash = this.hashBang;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, true);\n\t\t\t\t\t} else if(this.type == 'history') {\n\t\t\t\t\t\twindow.addEventListener('popstate', function(evt) {\n\t\t\t\t\t\t\tif(!evt.state || !evt.state.azaza) return;\n\t\t\t\t\t\t\tMK.set(this, 'url', location.pathname, {\n\t\t\t\t\t\t\t\tpopEvent: true\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}.bind(this));\n\n\t\t\t\t\t\tMK.onDebounce(this, 'change:url', function(evt) {\n\t\t\t\t\t\t\tif(!evt || !evt.popEvent) {\n\t\t\t\t\t\t\t\thistory.pushState({\n\t\t\t\t\t\t\t\t\tazaza: true\n\t\t\t\t\t\t\t\t}, '', this.url + location.hash);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.initialized = true;\n\t\t\t}\n\t\t},\n\t\tsubscribe: function(obj, route) {\n\t\t\tvar keys = route.replace(/\\/\\//g, '/').replace(/^\\/|\\/$/g, '').split('/'),\n\t\t\t\tfilteredKeys = keys.filter(function(key) {\n\t\t\t\t\treturn key != '*';\n\t\t\t\t}),\n\t\t\t\tparts = [];\n\n\t\t\tthis.init();\n\n\t\t\tMK.on(obj, filteredKeys.map(function(key) {\n\t\t\t\treturn 'change:' + key\n\t\t\t}).join(' '), function(evt) {\n\t\t\t\tif(evt && evt.routeSilent) return;\n\n\t\t\t\tvar values = [];\n\t\t\t\tfor(var i = 0; i < keys.length; i++) {\n\t\t\t\t\tif(keys[i] != '*') {\n\t\t\t\t\t\tif(obj[keys[i]]) {\n\t\t\t\t\t\t\tvalues.push(obj[keys[i]]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif(this.parts[i]) {\n\t\t\t\t\t\t\tvalues.push(this.parts[i]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tthis.parts = values;\n\t\t\t}, this);\n\n\t\t\tMK.on(this, 'urlchange', function() {\n\t\t\t\tfor(var i = 0; i < keys.length; i++) {\n\t\t\t\t\tif(keys[i] != '*') {\n\t\t\t\t\t\tMK.set(obj, keys[i], this.parts[i] || null, {\n\t\t\t\t\t\t\trouteSilent: true\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfor(var i = 0; i < keys.length; i++) {\n\t\t\t\tparts.push(obj[keys[i]] == '*' ? this.parts[i] : obj[keys[i]] || this.parts[i]);\n\t\t\t}\n\n\t\t\tthis.parts = parts;\n\n\t\t\treturn this;\n\t\t}\n\t});\n\n\tMK.Router = Router;\n\tMK.Router.history = new Router('history');\n\tMK.Router.hash = new Router('hash');\n\n\tMK.initRouter = function(obj, route, type) {\n\t\tMK.Router[type || 'hash'].subscribe(obj, route);\n\t\treturn obj;\n\t};\n\n\tMK.prototype.initRouter = function(route, type) {\n\t\tMK.Router[type || 'hash'].subscribe(this, route);\n\t\treturn this;\n\t};\n\n\treturn Router;\n}));\n"],"sourceRoot":"/source/"}
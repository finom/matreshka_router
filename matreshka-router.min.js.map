{"version":3,"sources":["matreshka-router.min.js"],"names":["root","factory","define","amd","module","exports","require","Matreshka","this","MK","Router","type","Error","linkProps","onDebounce","on","win","window","extend","prototype","parts","url","hashBang","init","initialized","_this","location","document","v","fixed","replace","split","i","length","push","join","evt","value","prevValue","previousValue","equals","trigger","addEventListener","set","hash","hashEvent","state","validPush","pathname","popEvent","history","pushState","subscribe","obj","route","keys","filteredKeys","filter","key","map","routeSilent","values","initRouter"],"mappings":"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","file":"matreshka-router.min.js","sourcesContent":["(function(root, factory) {\n\t/* istanbul ignore next */\n\tif (typeof define === 'function' && define.amd) {\n\t\tdefine(['matreshka'], factory);\n\t} else if (typeof module === 'object' && module.exports) {\n\t\tmodule.exports = factory(require('matreshka'));\n\t} else {\n\t\tfactory(root.Matreshka);\n\t}\n}(this, function(MK) {\n\t\"use strict\";\n\n\t/* istanbul ignore if */\n\tif (!MK) {\n\t\tthrow Error('Matreshka is missing');\n\t}\n\n\tvar linkProps = MK.linkProps,\n\t\tonDebounce = MK.onDebounce,\n\t\ton = MK.on,\n\t\twin = typeof window != 'undefined' ? window : null;\n\n\tfunction Router(type) {\n\t\t// singletone pattern for history and hash router\n\t\tif (type in Router) {\n\t\t\treturn Router[type];\n\t\t}\n\n\t\tthis.type = type;\n\t}\n\n\tMK.extend(Router.prototype, {\n\t\tparts: [],\n\t\turl: '/',\n\t\thashBang: '!#/',\n\t\tinit: function() {\n\t\t\tif (this.initialized) return;\n\n\t\t\tvar _this = this,\n\t\t\t\ttype = _this.type,\n\t\t\t\tlocation = document.location;\n\n\n\t\t\tlinkProps(_this, 'parts', 'url', function(v) {\n\t\t\t\tvar fixed = v.replace(/\\/\\//g, '/')\n\t\t\t\t\t.replace(/^\\/|\\/$/g, '');\n\n\t\t\t\treturn fixed ? fixed.split('/') : [];\n\t\t\t});\n\n\t\t\tlinkProps(_this, 'url', 'parts', function(v) {\n\t\t\t\tvar parts = [],\n\t\t\t\t\ti;\n\t\t\t\tfor (i = 0; i < v.length; i++) {\n\t\t\t\t\tif (v[i]) {\n\t\t\t\t\t\tparts.push(v[i]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn parts.length ? ('/' + parts.join('/') + '/') : '/';\n\t\t\t});\n\n\t\t\tlinkProps(_this, 'hashBang', 'url', function(v) {\n\t\t\t\treturn v && v != '/' ? '#!' + v : '';\n\t\t\t});\n\n\t\t\tlinkProps(_this, 'url', 'hashBang', function(v) {\n\t\t\t\treturn v ? v.replace(/^#!/, '') : '';\n\t\t\t});\n\n\t\t\ton(_this, 'change:parts', function(evt) {\n\t\t\t\tvar value = evt.value,\n\t\t\t\t\tprevValue = evt.previousValue,\n\t\t\t\t\tequals = value.length == prevValue.length,\n\t\t\t\t\ti;\n\n\t\t\t\tif (equals) {\n\t\t\t\t\tfor (i = 0; i < value.length; i++) {\n\t\t\t\t\t\tif (value[i] != prevValue[i]) {\n\t\t\t\t\t\t\tequals = false;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!equals) {\n\t\t\t\t\tMK.trigger(_this, 'urlchange');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (win) {\n\t\t\t\tif (type == 'hash') {\n\t\t\t\t\twin.addEventListener('hashchange', function() {\n\t\t\t\t\t\tMK.set(_this, 'hashBang', location.hash, {\n\t\t\t\t\t\t\thashEvent: true\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\tonDebounce(_this, 'change:hashBang', function(evt) {\n\t\t\t\t\t\tif (!evt || !evt.hashEvent) {\n\t\t\t\t\t\t\tlocation.hash = _this.hashBang;\n\t\t\t\t\t\t}\n\t\t\t\t\t}, true);\n\t\t\t\t} else if (type == 'history') {\n\t\t\t\t\twin.addEventListener('popstate', function(evt) {\n\t\t\t\t\t\tif (evt.state && evt.state.validPush) {\n\t\t\t\t\t\t\tMK.set(_this, 'url', location.pathname, {\n\t\t\t\t\t\t\t\tpopEvent: true\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tonDebounce(_this, 'change:url', function(evt) {\n\t\t\t\t\t\tif (!evt || !evt.popEvent) {\n\t\t\t\t\t\t\thistory.pushState({\n\t\t\t\t\t\t\t\tvalidPush: true\n\t\t\t\t\t\t\t}, '', _this.url + location.hash);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t_this.initialized = true;\n\n\t\t\treturn _this;\n\n\t\t},\n\t\tsubscribe: function(obj, route) {\n\t\t\tvar _this = this,\n\t\t\t\tkeys = route.replace(/\\/\\//g, '/').replace(/^\\/|\\/$/g, '').split('/'),\n\t\t\t\tfilteredKeys = keys.filter(function(key) {\n\t\t\t\t\treturn key != '*';\n\t\t\t\t}),\n\t\t\t\tparts = [],\n\t\t\t\ti;\n\n\t\t\t_this.init();\n\n\t\t\ton(obj, filteredKeys.map(function(key) {\n\t\t\t\treturn 'change:' + key\n\t\t\t}).join(' '), function(evt) {\n\t\t\t\tif (evt && evt.routeSilent) return;\n\n\t\t\t\tvar values = [],\n\t\t\t\t\ti;\n\n\t\t\t\tfor (i = 0; i < keys.length; i++) {\n\t\t\t\t\tif (keys[i] != '*') {\n\t\t\t\t\t\tif (obj[keys[i]]) {\n\t\t\t\t\t\t\tvalues.push(obj[keys[i]]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (_this.parts[i]) {\n\t\t\t\t\t\t\tvalues.push(_this.parts[i]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t_this.parts = values;\n\t\t\t});\n\n\t\t\ton(_this, 'urlchange', function() {\n\t\t\t\tvar i;\n\t\t\t\tfor (i = 0; i < keys.length; i++) {\n\t\t\t\t\tif (keys[i] != '*') {\n\t\t\t\t\t\tMK.set(obj, keys[i], _this.parts[i] || null, {\n\t\t\t\t\t\t\trouteSilent: true\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfor (i = 0; i < keys.length; i++) {\n\t\t\t\tparts.push(obj[keys[i]] == '*' ? _this.parts[i] : obj[keys[i]] || _this.parts[i]);\n\t\t\t}\n\n\t\t\t_this.parts = parts;\n\n\t\t\treturn _this;\n\t\t}\n\t});\n\n\tMK.Router = Router;\n\tMK.Router.history = new Router('history');\n\tMK.Router.hash = new Router('hash');\n\n\tMK.initRouter = function(obj, route, type) {\n\t\tMK.Router[type || 'hash'].subscribe(obj, route);\n\t\treturn obj;\n\t};\n\n\tMK.prototype.initRouter = function(route, type) {\n\t\tMK.Router[type || 'hash'].subscribe(this, route);\n\t\treturn this;\n\t};\n\n\treturn Router;\n}));\n"],"sourceRoot":"/source/"}